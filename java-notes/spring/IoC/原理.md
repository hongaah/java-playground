# IoC

IoC 又称为依赖注入（DI：Dependency Injection），它解决了一个最主要的问题：将组件的创建+配置与组件的使用相分离，并且，由 IoC 容器负责管理组件的生命周期。

因为 IoC 容器要负责实例化所有的组件，因此，有必要告诉容器如何创建组件，以及各组件的依赖关系。一种最简单的配置是通过 XML 文件来实现，例如：

```xml
<beans>
    <bean id="dataSource" class="HikariDataSource" />
    <bean id="bookService" class="BookService">
        <property name="dataSource" ref="dataSource" />
    </bean>
    <bean id="userService" class="UserService">
        <property name="dataSource" ref="dataSource" />
    </bean>
</beans>
```

上述 XML 配置文件指示 IoC 容器创建 3 个 JavaBean 组件，并把 id 为 dataSource 的组件通过属性 dataSource（即调用 setDataSource() 方法）注入到另外两个组件中。

在 Spring 的 IoC 容器中，我们把所有组件统称为 JavaBean，即配置一个组件就是配置一个 Bean。

Spring 的 IoC 容器同时支持属性注入和构造方法注入，并允许混合使用。

## @Configuration

SpringBoot 推荐给容器中添加组件的方式，推荐使用全注解的方式 @Configuration。 
 
比如新建一个类，但是我不用 @Service 注解，也就是说，它是个普通的类，那么我们如何使它也成为一个 Bean 让 Spring 去管理呢？只需要 @Configuration 和 @Bean 两个注解即可。

```java
/**
 * @Configuration：指明当前类是一个配置类，就是来替代之前的 Spring 配置文件
 * 
 * @Bean 表示该方法返回一个 Bean。这样就把 TestService 作为 Bean 让 Spring 去管理了，在其他地方，我们如果需要使用该 Bean，和原来一样，直接使用 @Resource 注解注入进来即可使用，非常方便。
 * 
 * 在配置文件中用<bean><bean/>标签添加组件。在配置类中使用 @Bean 注解
 */
public class TestService {
    public String sayHello () {
        return "Hello Spring Boot!";
    }
}

@Configuration
public class JavaConfig {
    @Bean
    public TestService getTestService() {
        return new TestService();
    }
}

@Resource
private TestService testService;
```

## 无侵入容器

在设计上，Spring 的 IoC 容器是一个高度可扩展的无侵入容器。所谓无侵入，是指应用程序的组件无需实现 Spring 的特定接口，或者说，组件根本不知道自己在 Spring 的容器中运行。这种无侵入的设计有以下好处：

应用程序组件既可以在 Spring 的 IoC 容器中运行，也可以自己编写代码自行组装配置；
测试的时候并不依赖 Spring 容器，可单独进行测试，大大提高了开发效率。

